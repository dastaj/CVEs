# Proof of Concept (PoC)

## Disclaimer
This vulnerability was found in production environment of real application. To demonstrate the vulnerability in this repository, I used [Dave Gray's repository](https://github.com/gitdagray/next-auth-intro) and setup this application to work with Google Provider. Additionally, I commented `export` line `middleware.ts` to protect entire site with NextAuth.js.

## Description
1.  Go to `http://localhost:3000` in your browser. Application will redirect you to the Login Panel:
![image](https://github.com/dastaj/CVEs/assets/78434825/f4d66bcf-0319-4118-b8e0-de687116d0b3)
2. Click on `Sign in with Google` button. You will be redirected to Google
![image](https://github.com/dastaj/CVEs/assets/78434825/6ace1246-42d3-408e-aee1-357c9133f0ba)
3. Back to `http://localhost:3000`. Open `Storage` tab in `Developer mode` (CTRL+SHIFT+I in Google Chrome). You should have new cookies in you `Storage`, including `next-auth.pkce.code_verifier` and `next-auth.state`.
![image](https://github.com/dastaj/CVEs/assets/78434825/10eb2325-3230-4672-8dd5-432e7022afa0)
4. Change name of `next-auth.pkce.code_verifier` or `next-auth.state` cookie to `next-auth.session-token`
![image](https://github.com/dastaj/CVEs/assets/78434825/17b51a75-5be2-4d43-b27a-d286cd7fba82)
5. Once again, go to `http://localhost:3000` in your browser. You should be able to bypass authentication and explore application dashboards.
![image](https://github.com/dastaj/CVEs/assets/78434825/6772a290-8f76-4bf1-9222-7baef7eded4f)
