# Proof of Concept (PoC) for CVE-2023-48309

## Disclaimer
This vulnerability was identified in a production environment of a real-world application. For demonstration purposes in this repository, I have utilized [Dave Gray's repository](https://github.com/gitdagray/next-auth-intro) and configured the application to integrate with the Google Provider. To enhance security, the `export` line in `middleware.ts` has been commented out, ensuring the entire site is protected with NextAuth.js.

## PoC Steps

1. **Accessing the Application:**
   - Navigate to `http://localhost:3000` in your browser. The application will redirect you to the Login Panel.
   - ![Login Panel Redirect](https://github.com/dastaj/CVEs/assets/78434825/f4d66bcf-0319-4118-b8e0-de687116d0b3)

2. **Initiating Google Sign-In:**
   - Click on the `Sign in with Google` button. This action redirects you to Google's authentication page.
   - ![Google Sign-In](https://github.com/dastaj/CVEs/assets/78434825/6ace1246-42d3-408e-aee1-357c9133f0ba)

3. **Analyzing Cookies:**
   - After being redirected back to `http://localhost:3000`, open the `Storage` tab in `Developer mode` (CTRL+SHIFT+I in Mozilla Firefox).
   - In the `Storage` section, check for new cookies, especially `next-auth.pkce.code_verifier` and `next-auth.state`.
   - ![Cookie Storage](https://github.com/dastaj/CVEs/assets/78434825/10eb2325-3230-4672-8dd5-432e7022afa0)

4. **Manipulating Cookie Names:**
   - Rename either the `next-auth.pkce.code_verifier` or `next-auth.state` cookie to `next-auth.session-token`.
   - ![Cookie Manipulation](https://github.com/dastaj/CVEs/assets/78434825/17b51a75-5be2-4d43-b27a-d286cd7fba82)

5. **Bypassing Authentication:**
   - Revisit `http://localhost:3000` in your browser. With the modified cookie, you should be able to bypass the authentication mechanism and gain unauthorized access to application dashboards.
   - ![Unauthorized Dashboard Access](https://github.com/dastaj/CVEs/assets/78434825/6772a290-8f76-4bf1-9222-7baef7eded4f)

**Note:** This Proof of Concept is provided for educational and ethical testing purposes only. Unauthorized access to applications is illegal and unethical.
